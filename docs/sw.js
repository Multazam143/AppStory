const CACHE_NAME="story-app-v1",DATA_CACHE_NAME="story-app-data-v1",BASE_PATH=self.location.pathname.startsWith("/AppStory")?"/AppStory":"",urlsToCache=[`${BASE_PATH}/`,`${BASE_PATH}/index.html`,`${BASE_PATH}/manifest.json`,`${BASE_PATH}/app.bundle.js`,`${BASE_PATH}/images/logo.png`,`${BASE_PATH}/icons/icon-192x192.png`,`${BASE_PATH}/icons/icon-512x512.png`];self.addEventListener("install",(t=>{console.log("[SW] Installing"),t.waitUntil(caches.open(CACHE_NAME).then((t=>(console.log("[SW] Caching App Shell"),t.addAll(urlsToCache))))),self.skipWaiting()})),self.addEventListener("activate",(t=>{console.log("[SW] Activating"),t.waitUntil(caches.keys().then((t=>Promise.all(t.map((t=>t!==CACHE_NAME&&t!==DATA_CACHE_NAME?(console.log("[SW] Deleting old cache:",t),caches.delete(t)):null)))))),self.clients.claim()})),self.addEventListener("fetch",(t=>{new URL(t.request.url).href.startsWith("https://story-api.dicoding.dev/v1/stories")&&"GET"===t.request.method?t.respondWith(caches.open(DATA_CACHE_NAME).then((e=>fetch(t.request).then((n=>(200===n.status&&e.put(t.request.url,n.clone()),n))).catch((()=>e.match(t.request)))))):t.respondWith(caches.match(t.request).then((e=>e||fetch(t.request))))})),self.addEventListener("push",(t=>{console.log("[SW] Push event received");let e={};try{e=t.data?t.data.json():{}}catch{console.error("[SW] Push payload is not JSON")}const n=e.title||"Story App",o={body:e.body||"Ada story baru ditambahkan!",icon:`${BASE_PATH}/images/logo.png`,badge:`${BASE_PATH}/images/logo.png`,data:{url:e.url||`${BASE_PATH}/#/`}};t.waitUntil(self.registration.showNotification(n,o))})),self.addEventListener("notificationclick",(t=>{t.notification.close(),t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(const n of e)if(n.url===t.notification.data.url&&"focus"in n)return n.focus();return clients.openWindow(t.notification.data.url)})))}));
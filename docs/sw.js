const CACHE_NAME="story-app-v1",DATA_CACHE_NAME="story-app-data-v1",urlsToCache=["/","/index.html","/manifest.json","/app.bundle.js","/images/logo.png","/icons/icon-192x192.png","/icons/icon-512x512.png"];self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("[SW] Caching App Shell"),e.addAll(urlsToCache))))),self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>e!==CACHE_NAME&&e!==DATA_CACHE_NAME?(console.log("[SW] Deleting old cache:",e),caches.delete(e)):null)))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{new URL(e.request.url).href.startsWith("https://story-api.dicoding.dev/v1/stories")&&"GET"===e.request.method?e.respondWith(caches.open(DATA_CACHE_NAME).then((t=>fetch(e.request).then((n=>(200===n.status&&t.put(e.request.url,n.clone()),n))).catch((()=>t.match(e.request)))))):e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request))))})),self.addEventListener("push",(e=>{console.log("[SW] Push event received");let t={};try{t=e.data?e.data.json():{}}catch(e){console.error("[SW] Push payload is not JSON")}const n=t.title||"Story App",s={body:t.body||"Ada story baru ditambahkan!",icon:"/images/logo.png",badge:"/images/logo.png",data:{url:t.url||"/#/"}};e.waitUntil(self.registration.showNotification(n,s))})),self.addEventListener("notificationclick",(e=>{e.notification.close(),e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((t=>{for(const n of t)if(n.url===e.notification.data.url&&"focus"in n)return n.focus();return clients.openWindow(e.notification.data.url)})))}));